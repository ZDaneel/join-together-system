> 基础框架参考：[从0开始带你手撸一套SpringBoot+Vue后台管理系统（2022年最新版）-哔哩哔哩]( https://b23.tv/4Y7K0qd)

使用邮件发送功能，需要替换resource目录下的发送邮件的账户和授权码

# 课题

拼团--团队活动AA 制，软件项目的基本功能要求如下：
1、组团
（1）团长创建(组建) 团队并发布活动消息（时间、起点、主要内容等）；
（2）加入团员（团员申请参加活动）；
（3）（团长）确定团队成立，并通知参与人；
（4）确定团队活动的起始时间，交纳团费（可多次交纳）；
2、团队活动
（1）每次团队活动记录参加人员，活动费用参与人员均摊；
（2）活动过程中根据需要追加AA 费用，也支持某团员独立追加费用；
（3）活动结束，计算团队成员分推费用；
（4）支持输出帐单，并导出到EXCEL 表格中。
（5）活动结束，生成活动报告。

# 分析与设计

## 核心功能

### 一、已有活动

未参加的、正在进行的、没有成团的、不是自己创建的

### 二、创建活动

创建活动

### 三、已创建活动

1、自己创建的、正在进行的、没有成团的、没有缴费的——编辑、成团、取消

2、自己创建的、正在进行的、已经成团的、没有缴费的——增加费用、结束活动

3、自己创建的、已经结束的、已经成团的、没有缴费的——查询账单缴费

### 四、已参加活动

1、不是自己创建的、正在进行的、没有成团的、没有缴费的——退出

2、不是自己创建的、正在进行的、已经成团的、没有缴费的——增加费用

3、不是自己创建的、已经结束的、已经成团的、没有缴费的——查询账单缴费

### 活动历史记录

自己创建或者参与了的、已经结束的、已经缴费的

## 要求

团队

- 分工明确
  - 分析、架构
  - 前端
  - 后端
  - 部署测试——jar包、前端
  - 文档

- 技术模块

先拆分模块

- 理解整体框架

- 版本控制工具——git
- 开发环境——idea
- 单元测试
- 集成测试
- 跨设备——Docker部署

项目管理

- 个人工作量量化

- 量化评价标准

安全和法律

- 隐私设计——权限系统、密码加密

方法创新

- 独到见解

文档质量

- 内容

- 排版

软件质量

- 界面优美
- 功能完整
- 无bug



## 设计

1、需求分析

2、总体设计

3、详细设计

4、编码设计

5、运行测试

## 问题

### 一、怎么实现权限控制的

使用JWT进行验证。用户登录成功之后后端生成一个token，与成功的信息一起返回给前端；前端将token存到本地存储空间。之后每次请求都在请求体里加入token，后端接收数据时，判断是否有token，如果有token就放行到Controller方法，否则就提示用户重新登录。通过拦截器设置放行，放行登录注册。

### 二、 靠什么区分不同的活动

活动和用户是多对多关系，所以要一个中间表存放关联的关系，中间表存放的是用户和活动对应的关系，其中通过是否正在进行，是否成团，是否缴费这几个字段来进行判断。

通过后端xml里的sql语句和数据库进行交互，选择相应的数据返回给前端。

### 三、如何区分独立费用和AA费用

在账单里添加一个字段，判断是不是AA费用。

在用户查询账单的时候，需要查询出活动AA的费用和自己创建的独立费用，我使用的是SQL里的UNION语句，根据活动编号和用户编号查询账单，使用UNION合并独立费用和AA费用，UNION上面是独立费用，下面是AA费用。

```sql
select *
from partybill
where bill_party_id = #{partyId}
  and bill_username = (select nickname from sys_user where id = #{userId})
  and is_aa = 0
UNION
select *
from partybill
where bill_party_id = #{partyId}
  and is_aa = 1
```

前端展示的时候会对AA费用进行处理，会将后端传过来的AA费用+独立费用中的AA费用，分别除以参加活动的人数，这样得到的就是实际应该支付的费用。

### 四、前后端交互流程——如何展示数据

前端使用封装好的axios，地址加上参数发送给后端，后端Controller接收后，业务层处理，再持久层与数据库交互。前端之间使用json格式进行传输。

补充如何进行分页。要做到分页，前端需要三个参数：第几页、一页上有多少数据、以及总共有多少数据。

前端将第几页和一页上的数据发送给后端，后端使用mybatis的插件PageHelper自动进行分页，返回前端的除了数据列表，还需要一个数据总数。

### 五、项目特色

1. 团长和团员的划分

团长有自己专属的用例，但是团长也是团员，也能进行团员的一些操作，如何处理团长和团员就显得尤为关键。我们的解决办法是划分不同的功能模块，不去特意强调团长和团员的身份，使得用户能够更加直观进行操作，免去了切换身份的麻烦，同时团长也能使用团员的身份添加独立费用，使得项目更贴合实际。

2. 活动状态变化清晰直观

从创建活动到结束活动完成缴费，在这个过程中活动有很多的状态，我们的项目就很好区分了这些状态，并进行相对应的展示，这样的状态区分更加贴合实际，符合用户的直观体验。
